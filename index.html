<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Soulforged Interactive Map (Draft)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="leaflet.css" />
    <script src="leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="map"></div>
	<div id="version">0.0.2-draft</div>
    <script>
	var bounds = new L.LatLngBounds(new L.LatLng(0, 0), new L.LatLng(180, 180));
	var overlay = new L.ImageOverlay("chart.jpg",
	  bounds, {
		opacity: 1,
		interactive: true
	  });

	var map = new L.Map('map', {
	  center: bounds.getCenter(),
	  minZoom: 3,
	  maxZoom: 5,
	  layers: [overlay],
	  maxBounds: bounds
	});

	map.fitBounds(bounds);

	map.on('click', function(e) {
	  var x = e.layerPoint.x;
	  var y = e.layerPoint.y;
	  var pp = map.layerPointToLatLng(L.point(x, y));
	  console.log(pp.lat + "\t" + pp.lng);
	});

	function createTooltip(data) {

	  let tooltip = "<b>" + data[0] + "</b><br/>";
	  tooltip += "<b>Space: </b>" + data[5] +"<br/>";
	  tooltip += "<b>Resources:</b><br/>";
	  for (let i = 6; i < data.length; i++) {
		tooltip += data[i] + "<br/>";
	  }

	  return tooltip;
	}

	$.get("https://content-sheets.googleapis.com/v4/spreadsheets/1-WgmASMM6UFd-mKJD7F-NsEmd6wxcBbk73hjtpDMO_8/values/'DB Map'!A2:AA?key=AIzaSyCPjKuJDVFpxEQ4D7krj5cPdUXYjDqSqkw", function(data) {
	  console.log(JSON.stringify(data));
	  let iconAnchor = L.point(18, 18);
	  for (let p of data.values) {
		let nodeName = p[0];
		let nodeType = p[1];
		let terrain = p[2];
		let x = p[3];
		let y = p[4];

		let myIcon = L.divIcon({
		  iconAnchor: iconAnchor,
		  className: 'icon icon-' + nodeType + ' icon-' + terrain,
		  html: nodeName
		});

		let toolTip = createTooltip(p);

		L.marker([x, y], {
		  icon: myIcon
		}).bindTooltip(toolTip).addTo(map);
	  }
	});
    </script>
  </body>
</html>